import{r as o,j as e,c as N,R as W}from"./client-Cce3474E.js";const s={API_KEY:"edith_api_key",API_BASE_URL:"edith_api_base_url",MODEL:"edith_model",CONVERSATIONS:"edith_conversations"};async function P(){return new Promise(r=>{chrome.storage.local.get([s.API_KEY,s.API_BASE_URL,s.MODEL],n=>{r({apiKey:n[s.API_KEY]||"",apiBaseUrl:n[s.API_BASE_URL]||"https://api.openai.com/v1",model:n[s.MODEL]||"gpt-4o-mini"})})})}async function Y(r){const n={};return r.apiKey!==void 0&&(n[s.API_KEY]=r.apiKey),r.apiBaseUrl!==void 0&&(n[s.API_BASE_URL]=r.apiBaseUrl),r.model!==void 0&&(n[s.MODEL]=r.model),new Promise(a=>{chrome.storage.local.set(n,a)})}async function C(){return new Promise(r=>{chrome.storage.local.get(s.CONVERSATIONS,n=>{r(n[s.CONVERSATIONS]||[])})})}function H(){const[r,n]=o.useState("chat"),[a,c]=o.useState({apiKey:"",apiBaseUrl:"https://api.openai.com/v1",model:"gpt-4o-mini"}),[j,w]=o.useState([]),[x,b]=o.useState(null),[I,h]=o.useState([]),[u,k]=o.useState(""),[p,D]=o.useState("chat"),[g,m]=o.useState(!1),[S,v]=o.useState([]),[_,f]=o.useState(""),z=o.useRef(null);o.useEffect(()=>{P().then(c),C().then(w)},[]),o.useEffect(()=>{const t=l=>{if(l.type==="agent_progress")v(i=>[...i.slice(-30),l.text]);else if(l.type==="agent_done")m(!1),v([]),f(""),C().then(i=>{w(i);const d=i.find(y=>y.id===l.conversationId);d&&(b(d.id),h(d.messages))});else if(l.type==="agent_error"){m(!1),v([]),f("");const i={id:crypto.randomUUID(),role:"assistant",content:`âŒ ${l.error}`,timestamp:Date.now()};h(d=>[...d,i])}};return chrome.runtime.onMessage.addListener(t),()=>chrome.runtime.onMessage.removeListener(t)},[]),o.useEffect(()=>{z.current?.scrollIntoView({behavior:"smooth"})},[I,S]);const B=j.find(t=>t.id===x),U=()=>{b(null),h([]),v([]),f("")},M=t=>{b(t.id),h(t.messages),v([]),f(""),n("chat")},T=o.useCallback(async()=>{if(!u.trim()||g)return;const t=u.trim();k(""),m(!0),v([]),f(p==="agent"?"Starting agent...":"Thinking...");const l={id:crypto.randomUUID(),role:"user",content:t,timestamp:Date.now()};h(i=>[...i,l]);try{if(p==="agent")await chrome.runtime.sendMessage({type:"AGENT_RUN",prompt:t,conversationId:x});else{const i=await chrome.runtime.sendMessage({type:"CHAT",prompt:t,conversationId:x});if(!i?.ok)throw new Error(i?.error||"Unknown error");const d=await C();w(d);const y=d.find(L=>L.id===i.conversationId);y&&(b(y.id),h(y.messages)),m(!1),f("")}}catch(i){m(!1),f("");const d={id:crypto.randomUUID(),role:"assistant",content:`âŒ Error: ${String(i)}`,timestamp:Date.now()};h(y=>[...y,d])}},[u,g,p,x]),O=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),T())},K=async()=>{await Y(a),n("chat")};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100vh",background:"var(--bg-primary)",color:"var(--text-primary)",fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif",fontSize:"14px"},children:[e.jsxs("header",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 14px",background:"var(--bg-secondary)",borderBottom:"1px solid var(--border)",flexShrink:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("div",{style:{width:28,height:28,borderRadius:8,background:"var(--accent)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,fontSize:13},children:"E"}),e.jsx("span",{style:{fontWeight:600,fontSize:13,letterSpacing:"0.03em"},children:"EDITH"}),x&&B&&e.jsx("span",{style:{fontSize:11,color:"var(--text-secondary)",maxWidth:100,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:B.title})]}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx(E,{onClick:U,title:"New chat",children:"ï¼‹"}),e.jsx(E,{onClick:()=>n("history"),title:"History",active:r==="history",children:"â˜°"}),e.jsx(E,{onClick:()=>n("settings"),title:"Settings",active:r==="settings",children:"âš™"})]})]}),r==="settings"&&e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:16},children:[e.jsx("p",{style:{fontSize:11,color:"var(--text-secondary)",marginBottom:12,fontWeight:600},children:"SETTINGS"}),e.jsx(A,{label:"API Key",children:e.jsx("input",{type:"password",value:a.apiKey,onChange:t=>c({...a,apiKey:t.target.value}),placeholder:"sk-...",style:R})}),e.jsx(A,{label:"API Base URL",children:e.jsx("input",{type:"text",value:a.apiBaseUrl,onChange:t=>c({...a,apiBaseUrl:t.target.value}),placeholder:"https://api.openai.com/v1",style:R})}),e.jsxs(A,{label:"Model",children:[e.jsx("input",{type:"text",value:a.model,onChange:t=>c({...a,model:t.target.value}),placeholder:"gpt-4o-mini",style:R}),e.jsx("p",{style:{fontSize:11,marginTop:4,color:"var(--text-secondary)"},children:"Any OpenAI-compatible model: gpt-4o-mini, gpt-5-nano, llama3, etc."})]}),e.jsx("button",{onClick:K,style:{width:"100%",padding:"9px",borderRadius:8,background:"var(--accent)",color:"#fff",border:"none",cursor:"pointer",fontWeight:600,fontSize:13},children:"Save Settings"})]}),r==="history"&&e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:12},children:[e.jsx("p",{style:{fontSize:11,color:"var(--text-secondary)",marginBottom:10,fontWeight:600},children:"CONVERSATIONS"}),j.length===0&&e.jsx("p",{style:{fontSize:13,color:"var(--text-secondary)",textAlign:"center",marginTop:32},children:"No conversations yet"}),j.map(t=>e.jsxs("button",{onClick:()=>M(t),style:{width:"100%",textAlign:"left",padding:"10px 12px",marginBottom:6,borderRadius:8,cursor:"pointer",background:t.id===x?"var(--accent-dim)":"var(--bg-card)",border:`1px solid ${t.id===x?"var(--accent)":"var(--border)"}`,color:"var(--text-primary)"},children:[e.jsx("div",{style:{fontSize:13,fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.title}),e.jsxs("div",{style:{fontSize:11,marginTop:2,color:"var(--text-secondary)"},children:[new Date(t.updatedAt).toLocaleDateString()," Â· ",t.messages.length," messages"]})]},t.id))]}),r==="chat"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:12,display:"flex",flexDirection:"column",gap:10},children:[I.length===0&&!g&&e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",padding:"0 20px"},children:[e.jsx("div",{style:{width:52,height:52,borderRadius:16,background:"var(--accent)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:22,fontWeight:700,color:"#fff",marginBottom:14,boxShadow:"0 0 30px rgba(92,115,242,0.35)"},children:"E"}),e.jsx("p",{style:{fontWeight:600,fontSize:15,marginBottom:4},children:"EDITH"}),e.jsxs("p",{style:{fontSize:13,color:"var(--text-secondary)",lineHeight:1.5,marginBottom:16},children:["Your AI browser agent. Use ",e.jsx("strong",{style:{color:"var(--accent)"},children:"ðŸ¤– Agent Mode"})," to automate any browser task."]}),e.jsx("div",{style:{width:"100%",display:"flex",flexDirection:"column",gap:6},children:["Go to YouTube and search for Coldplay music","Search Amazon for wireless headphones under $50","Open GitHub and show trending repos today"].map(t=>e.jsx("button",{onClick:()=>k(t),style:{textAlign:"left",padding:"8px 12px",borderRadius:8,fontSize:12,cursor:"pointer",background:"var(--bg-card)",border:"1px solid var(--border)",color:"var(--text-secondary)"},children:t},t))})]}),I.map(t=>e.jsx(F,{msg:t},t.id)),g&&S.length>0&&e.jsxs("div",{style:{background:"var(--bg-card)",border:"1px solid var(--border)",borderRadius:10,padding:"10px 12px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:6,color:"var(--accent)",fontSize:12,fontWeight:600},children:[e.jsx("span",{style:{width:8,height:8,borderRadius:"50%",background:"var(--accent)",animation:"pulse 1.5s infinite"}}),"Agent running..."]}),S.map((t,l)=>e.jsx("div",{style:{fontSize:11,color:"var(--text-secondary)",fontFamily:"monospace",paddingLeft:14},children:t},l))]}),g&&S.length===0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12,color:"var(--text-secondary)"},children:[e.jsx("span",{style:{width:16,height:16,border:"2px solid var(--accent)",borderTopColor:"transparent",borderRadius:"50%",animation:"spin 1s linear infinite",flexShrink:0}}),_||"Thinking..."]}),e.jsx("div",{ref:z})]}),e.jsxs("div",{style:{flexShrink:0,padding:"10px 12px",borderTop:"1px solid var(--border)",background:"var(--bg-secondary)"},children:[e.jsxs("div",{style:{display:"flex",gap:6,marginBottom:8,alignItems:"center"},children:[["chat","agent"].map(t=>e.jsx("button",{onClick:()=>D(t),style:{padding:"4px 10px",borderRadius:6,fontSize:12,cursor:"pointer",fontWeight:500,background:p===t?"var(--accent)":"var(--bg-card)",color:p===t?"#fff":"var(--text-secondary)",border:`1px solid ${p===t?"var(--accent)":"var(--border)"}`},children:t==="agent"?"ðŸ¤– Agent":"ðŸ’¬ Chat"},t)),p==="agent"&&e.jsx("span",{style:{fontSize:11,color:"var(--warning)"},children:"Controls your browser"})]}),e.jsxs("div",{style:{display:"flex",gap:8,background:"var(--bg-card)",border:"1px solid var(--border)",borderRadius:12,padding:"8px 10px",alignItems:"flex-end"},children:[e.jsx("textarea",{value:u,onChange:t=>k(t.target.value),onKeyDown:O,placeholder:p==="agent"?"Give EDITH a browser task...":"Ask EDITH anything...",rows:1,disabled:g,style:{flex:1,resize:"none",background:"transparent",border:"none",outline:"none",color:"var(--text-primary)",fontSize:13,fontFamily:"inherit",maxHeight:100,overflowY:"auto"}}),e.jsx("button",{onClick:T,disabled:g||!u.trim(),style:{width:32,height:32,borderRadius:8,flexShrink:0,cursor:"pointer",background:g||!u.trim()?"rgba(92,115,242,0.3)":"var(--accent)",border:"none",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center"},children:"âž¤"})]}),e.jsx("p",{style:{fontSize:10,marginTop:6,textAlign:"center",color:"var(--text-secondary)",opacity:.6},children:"Enter to send Â· Shift+Enter for new line"})]})]})]})}function F({msg:r}){const n=r.role==="user";return r.role==="tool"?e.jsxs("div",{style:{background:"var(--bg-card)",border:"1px solid var(--border)",borderRadius:8,padding:"8px 10px",fontSize:11,fontFamily:"monospace"},children:[e.jsxs("div",{style:{color:"var(--accent)",fontWeight:600,marginBottom:4},children:["ðŸ”§ ",r.toolName]}),e.jsx("div",{style:{color:"var(--text-secondary)",whiteSpace:"pre-wrap",maxHeight:120,overflowY:"auto"},children:r.content})]}):e.jsxs("div",{style:{display:"flex",justifyContent:n?"flex-end":"flex-start",alignItems:"flex-start",gap:8},children:[!n&&e.jsx("div",{style:{width:24,height:24,borderRadius:6,background:"var(--accent)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,fontWeight:700,flexShrink:0},children:"E"}),e.jsxs("div",{style:{maxWidth:"78%",padding:"8px 12px",fontSize:13,lineHeight:1.5,borderRadius:n?"14px 14px 4px 14px":"4px 14px 14px 14px",background:n?"var(--accent)":"var(--bg-card)",color:n?"#fff":"var(--text-primary)",border:n?"none":"1px solid var(--border)",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:[r.toolCalls&&r.toolCalls.length>0&&e.jsx("div",{style:{marginBottom:6,display:"flex",flexDirection:"column",gap:3},children:r.toolCalls.map(c=>e.jsxs("span",{style:{fontSize:11,background:"rgba(92,115,242,0.2)",color:"var(--accent)",padding:"2px 6px",borderRadius:4},children:["ðŸ”§ ",c.name]},c.id))}),r.content]})]})}function E({children:r,onClick:n,title:a,active:c}){return e.jsx("button",{onClick:n,title:a,style:{width:28,height:28,borderRadius:6,cursor:"pointer",background:"var(--bg-card)",border:"1px solid var(--border)",color:c?"var(--accent)":"var(--text-secondary)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:13},children:r})}function A({label:r,children:n}){return e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:{fontSize:11,color:"var(--text-secondary)",display:"block",marginBottom:4,fontWeight:500},children:r}),n]})}const R={width:"100%",padding:"8px 10px",borderRadius:8,fontSize:13,background:"var(--bg-card)",border:"1px solid var(--border)",color:"var(--text-primary)",outline:"none",boxSizing:"border-box"},G=N.createRoot(document.getElementById("root"));G.render(e.jsx(W.StrictMode,{children:e.jsx(H,{})}));
